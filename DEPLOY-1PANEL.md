# 1Panel 部署指南

## 环境要求

- Node.js >= 18.0.0
- npm >= 9.0.0

## 部署步骤

### 1. 创建网站

1. 登录1Panel后台
2. 点击「网站」→「创建网站」
3. 填写基本信息：
   - 网站名称：AI作业小助手
   - 域名：根据实际情况填写（如aihomework.example.com）
   - 网站类型：**Node.js应用**
   - 应用框架：Express
   - 应用启动文件：`server.js`
   - 点击「确定」

### 2. 配置Node.js环境

1. 点击「应用商店」
2. 搜索并安装「Node.js」应用
3. 版本选择：**18.x 或更高版本**
4. 安装完成后，返回网站详情页

### 3. 克隆代码

1. 点击「文件」标签
2. 删除默认生成的index.html文件
3. 点击「Git」标签
4. 配置Git仓库：
   - 仓库地址：`https://github.com/askqing/HomeWork-AIMonitor.git`
   - 分支：main
   - 点击「克隆」

### 4. 安装依赖

1. 点击「终端」标签
2. 执行命令安装依赖：
   ```bash
   npm install
   ```

### 5. 构建项目

1. 在终端中执行构建命令：
   ```bash
   npm run build
   ```
2. 构建完成后，会在根目录生成`dist`文件夹

### 6. 配置环境变量

1. 点击「环境」标签
2. 点击「添加变量」
3. 添加以下必要的环境变量（根据实际情况填写）：
   - PORT：3000（可自定义）
   - GEMINI_API_KEY：你的Gemini API密钥
   - DINGTALK_WEBHOOK：你的钉钉机器人Webhook地址
   - DINGTALK_SECRET：你的钉钉机器人密钥（可选）
   - MERCHANT_ID：你的商户ID（如果需要支付功能）
   - API_KEY：你的API密钥（如果需要支付功能）
4. 点击「确定」

### 7. 启动服务

1. 点击「服务」标签
2. 点击「启动」按钮
3. 等待服务启动完成

### 8. 访问验证

- 在浏览器中访问你的域名，验证网站是否正常运行
- 测试API功能（如作业分析、通知推送等）

## 注意事项

1. **动态网站优势**：
   - 前端和后端API在同一服务器上运行
   - 无需配置跨域资源共享（CORS）
   - 更简单的部署和维护

2. **端口配置**：
   - 默认使用3000端口
   - 可以在环境变量中自定义PORT

3. **更新代码**：
   - 后续更新代码时，只需在Git标签页点击「拉取」
   - 重新执行`npm install`（如果依赖有变化）
   - 重新执行`npm run build`
   - 点击「服务」标签页的「重启」按钮

4. **性能优化**：
   - 可以配置Nginx反向代理
   - 启用静态文件缓存
   - 根据实际负载调整Node.js进程数

## 常见问题

### 1. 服务启动失败

**原因**：
- Node.js版本过低
- 缺少必要的环境变量
- 端口被占用

**解决**：
- 确保Node.js版本 >= 18.0.0
- 检查环境变量配置是否完整
- 尝试更改PORT环境变量为其他端口

### 2. API请求失败

**原因**：
- API密钥配置错误
- 网络连接问题
- 服务未完全启动

**解决**：
- 检查API密钥是否正确
- 查看服务日志了解具体错误
- 重启服务尝试

### 3. 页面加载缓慢

**原因**：
- 静态文件未优化
- 服务器资源不足
- 网络延迟

**解决**：
- 确保已执行`npm run build`生成优化后的静态文件
- 考虑增加服务器资源
- 使用CDN加速静态资源

## 技术支持

如有其他问题，可查看项目README或提交issue到GitHub仓库。